



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A platform for building DAOs">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">
    
    
      
        <title>Query, Observables & Subscriptions - DAOstack Developer Portal</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="black" data-md-color-accent="pink">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#query-observables-subscription" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="DAOstack Developer Portal" aria-label="DAOstack Developer Portal" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../../../images/daostack-logoW.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              DAOstack Developer Portal
            </span>
            <span class="md-header-nav__topic">
              
                Query, Observables & Subscriptions
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/daostack/DAOstack-Hackers-Kit/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    daostack/DAOstack-Hackers-Kit
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="DAOstack Developer Portal" class="md-nav__button md-logo">
      
        <img alt="logo" src="../../../images/daostack-logoW.svg" width="48" height="48">
      
    </a>
    DAOstack Developer Portal
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/daostack/DAOstack-Hackers-Kit/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    daostack/DAOstack-Hackers-Kit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Stack
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Stack
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Infra
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Infra
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../infra/infraIntro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../infra/genesisProtocol/" title="Holographic Consensus" class="md-nav__link">
      Holographic Consensus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../arc/arcIntro/" title="Arc" class="md-nav__link">
      Arc
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3" checked>
    
    <label class="md-nav__link" for="nav-2-3">
      Client
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Client
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../clientIntro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GettingStarted/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../howToUseClient/" title="How To Use" class="md-nav__link">
      How To Use
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Query, Observables & Subscriptions
      </label>
    
    <a href="./" title="Query, Observables & Subscriptions" class="md-nav__link md-nav__link--active">
      Query, Observables & Subscriptions
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-subscription" class="md-nav__link">
    Why Subscription
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-query-and-subscribe" class="md-nav__link">
    How to Query and Subscribe
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-queries" class="md-nav__link">
    Creating Queries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entity-methods" class="md-nav__link">
    Entity Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-graphql-queries" class="md-nav__link">
    Raw GraphQL queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executing-a-query" class="md-nav__link">
    Executing a Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entity-methods_1" class="md-nav__link">
    Entity Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-graphql-queries_1" class="md-nav__link">
    Raw GraphQL queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subscribing-to-a-query" class="md-nav__link">
    Subscribing to a Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entity-methods_2" class="md-nav__link">
    Entity methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-graphql-queries_2" class="md-nav__link">
    Raw graphQL queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimizing-how-subscriptions-use-the-cache" class="md-nav__link">
    Optimizing How Subscriptions Use the Cache
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controlling-apollo-fetchpolicy" class="md-nav__link">
    Controlling Apollo fetchPolicy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subscribe-to-apollo-cache-changes" class="md-nav__link">
    Subscribe to Apollo Cache changes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-fetchalldata-with-nested-subscription" class="md-nav__link">
    Use fetchAllData with Nested subscription
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example/" title="Quick Example" class="md-nav__link">
      Quick Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://daostack.github.io/client/docs/globals.html" title="API Reference" class="md-nav__link">
      API Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Subgraph
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Subgraph
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../subgraph/subgraphIntro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../subgraph/queries/" title="GraphQL queries" class="md-nav__link">
      GraphQL queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../subgraph/entities/" title="Entities" class="md-nav__link">
      Entities
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../alchemy/alchemyIntro/" title="DApps/Alchemy" class="md-nav__link">
      DApps/Alchemy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../migration/" title="Migration" class="md-nav__link">
      Migration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingStarted/setupAlchemyDevMode/" title="Add features to Alchemy interface" class="md-nav__link">
      Add features to Alchemy interface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingStarted/setupGenericScheme/" title="Setup Generic Scheme for a DAO" class="md-nav__link">
      Setup Generic Scheme for a DAO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Add custom scheme to the DAO
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Add custom scheme to the DAO
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingStarted/customScheme/intro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3-2" type="checkbox" id="nav-4-3-2">
    
    <label class="md-nav__link" for="nav-4-3-2">
      Arc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-3-2">
        Arc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingStarted/customScheme/developCustomNonUniScheme/" title="Non-Universal Scheme" class="md-nav__link">
      Non-Universal Scheme
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingStarted/customScheme/developCustomUniScheme/" title="Universal Scheme" class="md-nav__link">
      Universal Scheme
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3-3" type="checkbox" id="nav-4-3-3">
    
    <label class="md-nav__link" for="nav-4-3-3">
      Migration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-3-3">
        Migration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingStarted/customScheme/registerToNewDAO/" title="Register scheme to new DAO" class="md-nav__link">
      Register scheme to new DAO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingStarted/customScheme/registerToExistingDAO/" title="Register scheme to existing DAO" class="md-nav__link">
      Register scheme to existing DAO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingStarted/customScheme/subgraphForNewScheme/" title="Subgraph: enable cache for new scheme" class="md-nav__link">
      Subgraph: enable cache for new scheme
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingStarted/customScheme/clientForNewScheme/" title="Client: interact with new Scheme" class="md-nav__link">
      Client: interact with new Scheme
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingStarted/deployDAO/" title="Deploy a DAO" class="md-nav__link">
      Deploy a DAO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../hackerkit/" title="Hacker-kit" class="md-nav__link">
      Hacker-kit
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Want to contribute?
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Want to contribute?
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../feature-requests/" title="Feature Requests" class="md-nav__link">
      Feature Requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../how-to-propose/" title="Propose to Genesis DAO" class="md-nav__link">
      Propose to Genesis DAO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../FAQ/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-subscription" class="md-nav__link">
    Why Subscription
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-query-and-subscribe" class="md-nav__link">
    How to Query and Subscribe
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-queries" class="md-nav__link">
    Creating Queries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entity-methods" class="md-nav__link">
    Entity Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-graphql-queries" class="md-nav__link">
    Raw GraphQL queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executing-a-query" class="md-nav__link">
    Executing a Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entity-methods_1" class="md-nav__link">
    Entity Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-graphql-queries_1" class="md-nav__link">
    Raw GraphQL queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subscribing-to-a-query" class="md-nav__link">
    Subscribing to a Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entity-methods_2" class="md-nav__link">
    Entity methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-graphql-queries_2" class="md-nav__link">
    Raw graphQL queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimizing-how-subscriptions-use-the-cache" class="md-nav__link">
    Optimizing How Subscriptions Use the Cache
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controlling-apollo-fetchpolicy" class="md-nav__link">
    Controlling Apollo fetchPolicy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subscribe-to-apollo-cache-changes" class="md-nav__link">
    Subscribe to Apollo Cache changes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-fetchalldata-with-nested-subscription" class="md-nav__link">
    Use fetchAllData with Nested subscription
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/daostack/DAOstack-Hackers-Kit/edit/master/docs/stack/client/querying.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="query-observables-subscription">Query, Observables &amp; Subscription<a class="headerlink" href="#query-observables-subscription" title="Permanent link">&para;</a></h1>
<p>Your interactions with the DAOstack subgraph will involve working with the following:</p>
<ul>
<li><em><strong>Query</strong></em>: the graphQL queries sent to graphnode to fetch DAOstack data from the subgraph.</li>
<li><em><strong>Observable</strong></em>: object representing the stream of data to which one can subscribe.</li>
<li><em><strong>Subscription</strong></em>: invokes a given function every time a new value is emitted for the observable.</li>
</ul>
<p>The entity methods provided by <code>@daostack/client</code> for querying the subgraph, by themselves do not actually send the query to the server. Instead, each methods returns an <em>Observable</em> to which we can <em>subscribe</em>, which is what actually initiates the query.</p>
<p>Take a look at the following methods that return observable:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">arc</span><span class="p">.</span><span class="nx">daos</span><span class="p">()</span>
<span class="nx">proposal</span><span class="p">.</span><span class="nx">state</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>

<p>Now, in order to query the server we must subscribe</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kr">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="nx">arc</span><span class="p">.</span><span class="nx">daos</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">daos</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`we found </span><span class="si">${</span><span class="nx">daos</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> results`</span><span class="p">)</span>
    <span class="p">)</span>

<span class="kr">const</span> <span class="nx">proposal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Propsal</span><span class="p">(</span><span class="s1">&#39;0x123abc....&#39;</span><span class="p">,</span> <span class="nx">arc</span><span class="p">)</span>
<span class="kd">let</span> <span class="nx">stateObservable</span> <span class="o">=</span> <span class="nx">proposal</span><span class="p">.</span><span class="nx">state</span><span class="p">()</span>

<span class="nx">stateObservable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">proposal</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">proposal</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
</td></tr></table>

<p>In this guide we will describe how to create &amp; send query and subscribe to the data requested by the query.</p>
<h2 id="why-subscription">Why Subscription<a class="headerlink" href="#why-subscription" title="Permanent link">&para;</a></h2>
<p>Subscriptions will cause the server to send you an update each time the data changes and are useful for composing asynchronous and event-based programs.</p>
<p>By default, subscribing to an observable will do two things:</p>
<ul>
<li>send a query to the server to fetch the data</li>
<li>send a subscription query to the server for update events</li>
</ul>
<h2 id="how-to-query-and-subscribe">How to Query and Subscribe<a class="headerlink" href="#how-to-query-and-subscribe" title="Permanent link">&para;</a></h2>
<h3 id="creating-queries">Creating Queries<a class="headerlink" href="#creating-queries" title="Permanent link">&para;</a></h3>
<p>As described in the following sections, you can query the subgraph using either entity methods or raw GraphQL queries.</p>
<h4 id="entity-methods">Entity Methods<a class="headerlink" href="#entity-methods" title="Permanent link">&para;</a></h4>
<p>The entity methods return an Observables which encapsulate some predefined qraphQL queries to fetch Entity data from the subgraph.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">proposals</span> <span class="k">of</span> <span class="n">the</span> <span class="n">DAO</span>
<span class="n">const</span> <span class="n">proposalsObservable</span> <span class="o">=</span> <span class="n">Proposal</span><span class="p">.</span><span class="k">search</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="err">{</span> <span class="k">where</span><span class="p">:</span> <span class="err">{</span> <span class="n">dao</span><span class="p">:</span> <span class="ss">&quot;0x123&quot;</span> <span class="err">}</span> <span class="err">}</span><span class="p">)</span>

<span class="o">//</span> <span class="n">members</span> <span class="k">of</span> <span class="n">the</span> <span class="n">given</span> <span class="n">dao</span>
<span class="n">const</span> <span class="n">membersObservable</span> <span class="o">=</span> <span class="n">dao</span><span class="p">.</span><span class="n">members</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>

<h4 id="raw-graphql-queries">Raw GraphQL queries<a class="headerlink" href="#raw-graphql-queries" title="Permanent link">&para;</a></h4>
<p>To have more control over what gets fetched from the subgraph you can also customize the query. These queries will follow the standard <a href="../subgraph/queries">graphQL syntax</a> which is used to query graph explorer directly. Though the query <strong>must be wrapped inside the <em>gql</em> tag</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">const</span> <span class="n">gql</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;graphql-tag&#39;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">titles</span> <span class="k">of</span> <span class="k">all</span> <span class="n">proposals</span> <span class="k">of</span> <span class="n">the</span> <span class="n">DAO</span>
<span class="n">let</span> <span class="n">query</span> <span class="o">=</span> <span class="n">gql</span><span class="o">`</span><span class="n">query</span> <span class="err">{</span>
  <span class="n">proposals</span> <span class="p">(</span> <span class="k">where</span><span class="p">:</span> <span class="err">{</span> <span class="n">dao</span><span class="p">:</span> <span class="ss">&quot;0x294f999356ed03347c7a23bcbcf8d33fa41dc830&quot;</span> <span class="err">}</span><span class="p">)</span> <span class="err">{</span> <span class="n">title</span> <span class="err">}</span>
<span class="err">}</span><span class="o">`</span>
</code></pre></div>
</td></tr></table>

<h3 id="executing-a-query">Executing a Query<a class="headerlink" href="#executing-a-query" title="Permanent link">&para;</a></h3>
<p>After creating a query, as we did in the previous section, we need to cause the query to be executed, that is, be sent to the graphnode server.</p>
<h4 id="entity-methods_1">Entity Methods<a class="headerlink" href="#entity-methods_1" title="Permanent link">&para;</a></h4>
<p>We can subscribe to an observable with <code>{subscribe: false}</code> parameter (introduced in the <a href="#entity-methods_2">subscribing to a query section</a>) for sending a one-time query without subscribing to further updates from the server for result of the query.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="k">Get</span> <span class="k">all</span> <span class="n">proposals</span><span class="err">&#39;</span> <span class="n">Id</span> <span class="k">of</span> <span class="n">the</span> <span class="n">DAO</span> <span class="k">without</span> <span class="n">subscribing</span> <span class="k">to</span> <span class="n">server</span>
<span class="n">const</span> <span class="n">proposalsObs</span> <span class="o">=</span> <span class="n">dao</span><span class="p">.</span><span class="n">proposals</span><span class="p">(</span><span class="err">{}</span><span class="p">,</span> <span class="err">{</span><span class="n">subscribe</span><span class="p">:</span> <span class="k">false</span><span class="err">}</span><span class="p">)</span>

<span class="o">//</span> <span class="n">send</span> <span class="n">query</span> <span class="k">and</span> <span class="n">subscribe</span> <span class="k">to</span> <span class="n">the</span> <span class="k">cache</span> <span class="n">updates</span>
<span class="n">proposalsObs</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="err">{}</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Unsubscribe</span> <span class="k">to</span> <span class="k">cache</span> <span class="n">once</span> <span class="n">done</span>
<span class="n">proposalsObs</span><span class="p">.</span><span class="n">unsubscribe</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>

<p><strong>Note</strong>: Refer to the <a href="#subscribe-to-apollo-cache-changes">Subscribe to Apollo Cache changes</a> section to understand difference between cache and server update.</p>
<h4 id="raw-graphql-queries_1">Raw GraphQL queries<a class="headerlink" href="#raw-graphql-queries_1" title="Permanent link">&para;</a></h4>
<p>You can submit raw GraphQL queries using the static method <code>arc.sendQuery</code>. Pass the query designed <a href="#raw-graphql-queries">above</a> as the parameter to <code>sendQuery</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="err">// Get votes id and outcome of the given Proposal</span>
<span class="err">arc.sendQuery(gql`query {</span>
<span class="err">    proposal (id: &quot;0x1245&quot;) {</span>
<span class="err">      votes { id outcome }</span>
<span class="err">    }}`)</span>
</code></pre></div>
</td></tr></table>

<h3 id="subscribing-to-a-query">Subscribing to a Query<a class="headerlink" href="#subscribing-to-a-query" title="Permanent link">&para;</a></h3>
<p>Use <em>Subscriptions</em> to invoke the handler that you supply to run every time a new value is emitted by an observable stream. This is useful to keep the app data updated as the value changes.</p>
<h4 id="entity-methods_2">Entity methods<a class="headerlink" href="#entity-methods_2" title="Permanent link">&para;</a></h4>
<p>As we saw the Entity methods do not send the query to the server but return an observable. We must subscribe as follows to send the query as well as subscribe for server updates.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="err">arc.daos().subscribe(() =&gt; {})</span>
<span class="err">dao.state().subscribe( () =&gt; {})</span>
</code></pre></div>
</td></tr></table>

<p><strong>Note</strong>: Refer to the <a href="#subscribe-to-apollo-cache-changes">Subscribe to Apollo Cache changes</a> section to understand difference between cache and server updates. </p>
<h4 id="raw-graphql-queries_2">Raw graphQL queries<a class="headerlink" href="#raw-graphql-queries_2" title="Permanent link">&para;</a></h4>
<p>For even more control over what data is being fetched and subscribed to, you can write explicit queries:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">arc</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">gql</span><span class="o">`</span><span class="n">subscribe</span> <span class="err">{</span> <span class="n">proposal</span> <span class="p">(</span><span class="n">id</span><span class="p">:</span> <span class="ss">&quot;0x1245&quot;</span><span class="p">)</span> <span class="err">{</span> <span class="n">votes</span> <span class="err">{</span> <span class="n">id</span> <span class="n">outcome</span> <span class="err">}}</span><span class="p">)</span><span class="o">`</span><span class="p">)</span>
<span class="k">new</span> <span class="n">Proposal</span><span class="p">(</span><span class="ss">&quot;0x1245&quot;</span><span class="p">).</span><span class="n">votes</span><span class="p">().</span><span class="n">subscribe</span><span class="p">(</span>
  <span class="p">(</span><span class="k">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="err">{</span>

  <span class="err">}</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>

<h2 id="optimizing-how-subscriptions-use-the-cache">Optimizing How Subscriptions Use the Cache<a class="headerlink" href="#optimizing-how-subscriptions-use-the-cache" title="Permanent link">&para;</a></h2>
<p>Since, subscriptions can be expensive, this behavior can be controlled/optimized in several ways. The client library uses <a href="https://www.apollographql.com/">Apollo</a> for data management which offers an intelligent caching and declarative approach to data fetching.</p>
<ul>
<li><a href="#controlling-apollo-fetchpolicy">Controlling fetchPolicy</a>: controlling cache interaction.</li>
<li><a href="#subscribe-to-apollo-cache-changes">Subscribing to Apollo Cache</a>: getting updates from Apollo cache instead of graphnode server.</li>
<li><a href="#use-fetchalldata-with-nested-subscription">FetchAllData and Nested subscription</a>: by querying larger set at top level and subscribing to Apollo cache for nested queries.</li>
</ul>
<h3 id="controlling-apollo-fetchpolicy">Controlling Apollo fetchPolicy<a class="headerlink" href="#controlling-apollo-fetchpolicy" title="Permanent link">&para;</a></h3>
<p>We can pass Apollo's <a href="https://www.apollographql.com/docs/react/api/react-apollo/#optionsfetchpolicy"><code>fetchPolicy</code></a> argument to control how the query interacts with the cache:</p>
<ul>
<li><em><strong>cache-first</strong></em>: default value. Read data from cache first, fetch from network if data is not available in cache.</li>
<li><em><strong>cache-and-network</strong></em>: return data from cache first and then always fetch from network to update the cache. It optimizes quick response while also keep cached data updated.</li>
<li><em><strong>network-only</strong></em>: will always make a request using network and write data to cache. It optimizes for data consistency with the server.</li>
<li><em><strong>cache-only</strong></em>: will never execute a query using your network interface and throw error if data not available in cache.</li>
<li><em><strong>no-cache</strong></em>: like <code>network-only</code> it will always make a request using your network interface. But, it will not write any data to the cache</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="err">arc.daos({}, { fetch-policy: &#39;cache-first&#39;}) // the default value</span>
<span class="err">arc.daos({where: {stage: &quot;Boosted&quot;}}, { fetch-policy: &#39;network-only&#39;}) // bypass the cache</span>
</code></pre></div>
</td></tr></table>

<h3 id="subscribe-to-apollo-cache-changes">Subscribe to Apollo Cache changes<a class="headerlink" href="#subscribe-to-apollo-cache-changes" title="Permanent link">&para;</a></h3>
<p>As we have seen the client library offers two types of subscription that can be controlled by the <code>subscribe</code> parameter.</p>
<ul>
<li><strong>server and cache</strong> <code>{ subscribe: true }</code>: explicitly ask for the updates from the graph-node server. Update the cache with the results of the query.</li>
<li><strong>only cache</strong> <code>{ subscribe: false }</code>: do not subscribe to the updates from the server but still subscribe to the Apollo cache changes.</li>
</ul>
<p>NOTE:</p>
<ul>
<li>By default <code>subscribe</code> is set to true.</li>
<li>Apollo cache could change as a result of another query which does subscribe to server changes.</li>
</ul>
<p>e.g.</p>
<p>In <em>q1</em> we will not subscribe to the updates from network but will still watch changes in the Apollo cache and return updated results if the cache changes.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">arc</span><span class="p">.</span><span class="nx">daos</span><span class="p">({},</span> <span class="p">{</span><span class="nx">fetchAllData</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">subscribe</span><span class="o">:</span> <span class="kc">false</span><span class="p">}).</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{})</span> <span class="c1">// q1</span>
</code></pre></div>
</td></tr></table>

<p>In <em>q2</em>  we subscribe to server updates. The results of these updates are added to the Apollo cache and the observable in <em>q1</em> will also get the updates if cache changes.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">dao</span><span class="p">.</span><span class="nx">state</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{})</span> <span class="c1">// q2</span>
</code></pre></div>
</td></tr></table>

<h3 id="use-fetchalldata-with-nested-subscription">Use fetchAllData with Nested subscription<a class="headerlink" href="#use-fetchalldata-with-nested-subscription" title="Permanent link">&para;</a></h3>
<p>Most of the Entity methods are implemented in such a way that the queries will fetch (and subscribe to) just as much data as is needed to create the result set. For example, <code>dao.proposals()</code> will only fetch the proposal IDs. This can be controlled (in a limited way) by setting the parameter <code>fetchAllData</code> to true</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="err">dao.proposals({orderBy: &quot;creationDate&quot;}, {fetchAllData: true})</span>
</code></pre></div>
</td></tr></table>

<p>This is useful for cache handling, where it may be useful to have more complete control over what data is being fetched. Consider the following example, which will get the list of proposals from the dao, and then get the state for each of the proposals.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="err">dao.proposals().subscribe(</span>
<span class="err">  (proposals) =&gt; {</span>
<span class="err">    for (let proposal of proposals) {</span>
<span class="err">      proposal.state().subscribe(.....)</span>
<span class="err">    }</span>
<span class="err">  }</span>
<span class="err">)</span>
</code></pre></div>
</td></tr></table>

<p>The problem with this pattern is that it is very expensive. The (subscription to) <code>dao.proposals(..)</code> will send a query and create a subscription and then each of the calls to <code>proposal.state()</code> will create a new query and a separate subscription.</p>
<p>Consider now the following pattern:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="err">dao.proposals({}, { fetchAllData: true }).subscribe(</span>
<span class="err">  (proposals) =&gt; {</span>
<span class="err">    for (let proposal of proposals) {</span>
<span class="err">      proposal.state({}, {subscribe: false }).subscribe(.....)</span>
<span class="err">    }</span>
<span class="err">  }</span>
<span class="err">)</span>
</code></pre></div>
</td></tr></table>

<p>This will resolve two inefficiencies. First of all, the <code>fetchAllData</code> in the proposals query will make it so that the
<code>dao.proposals</code> query will fetch (and subscribe to) a much larger query - in particular, it will get all state data for each of the proposals. This means that when <code>prop.state()</code> is called, it will find all the needed information in the cache (and so it will not send a new query to the server), and we can safely pass it the <code>subscribe: false</code> flag, because <code>dao.proposals()</code> already subscribes to updates for all the cached data.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../howToUseClient/" title="How To Use" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                How To Use
              </span>
            </div>
          </a>
        
        
          <a href="../example/" title="Quick Example" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Quick Example
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/daostack/DAOstack-Hackers-Kit" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://daostack.slack.com" target="_blank" rel="noopener" title="slack" class="md-footer-social__link fa fa-slack"></a>
    
      <a href="https://t.me/daostackcommunity" target="_blank" rel="noopener" title="telegram" class="md-footer-social__link fa fa-telegram"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>